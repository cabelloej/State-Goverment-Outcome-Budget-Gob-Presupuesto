store "ESTA SEGURO QUE DESEA REPROCESAR OPERACIONES ? (S/N)" TO TEX
STORE "NS" TO WCH
DO PREGUNTA
IF WCH = "N"
   RETURN
ENDIF
SELECT 1
use prctas index prctas1
DO FILLOC
GO TOP
DO WHILE .NOT. EOF()
   STORE SPACE(18) TO WCUENTA0
   DO ARMACOD0
   STORE "LIMPIANDO CUENTA: "+wcuenta0+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE LEN(RTRIM(WCUENTA0)) TO WLARCOD
   IF WLARCOD <> 18
      REPLACE INVE   WITH 0
      REPLACE CORR   WITH 0
      REPLACE ORIG   WITH 0
   ENDIF
   REPLACE TRAS      WITH 0
   REPLACE TRAS1     WITH 0
   REPLACE TRAS2     WITH 0
   REPLACE TRAS3     WITH 0
   REPLACE TRAS4     WITH 0
   REPLACE TRAS5     WITH 0
   REPLACE TRAS6     WITH 0
   REPLACE TRAS7     WITH 0
   REPLACE TRAS8     WITH 0
   REPLACE TRAS9     WITH 0
   REPLACE TRAS10    WITH 0
   REPLACE TRAS11    WITH 0
   REPLACE TRAS12    WITH 0
   REPLACE INCR      WITH 0
   REPLACE INCR1     WITH 0
   REPLACE INCR2     WITH 0
   REPLACE INCR3     WITH 0
   REPLACE INCR4     WITH 0
   REPLACE INCR5     WITH 0
   REPLACE INCR6     WITH 0
   REPLACE INCR7     WITH 0
   REPLACE INCR8     WITH 0
   REPLACE INCR9     WITH 0
   REPLACE INCR10    WITH 0
   REPLACE INCR11    WITH 0
   REPLACE INCR12    WITH 0
   REPLACE DISM      WITH 0
   REPLACE DISM1     WITH 0
   REPLACE DISM2     WITH 0
   REPLACE DISM3     WITH 0
   REPLACE DISM4     WITH 0
   REPLACE DISM5     WITH 0
   REPLACE DISM6     WITH 0
   REPLACE DISM7     WITH 0
   REPLACE DISM8     WITH 0
   REPLACE DISM9     WITH 0
   REPLACE DISM10    WITH 0
   REPLACE DISM11    WITH 0
   REPLACE DISM12    WITH 0
   REPLACE ASIG      WITH 0
   REPLACE COMP      WITH 0
   REPLACE COMP1     WITH 0
   REPLACE COMP2     WITH 0
   REPLACE COMP3     WITH 0
   REPLACE COMP4     WITH 0
   REPLACE COMP5     WITH 0
   REPLACE COMP6     WITH 0
   REPLACE COMP7     WITH 0
   REPLACE COMP8     WITH 0
   REPLACE COMP9     WITH 0
   REPLACE COMP10    WITH 0
   REPLACE COMP11    WITH 0
   REPLACE COMP12    WITH 0
   REPLACE CAUS      WITH 0
   REPLACE PAGA      WITH 0
   REPLACE PAGA1     WITH 0
   REPLACE PAGA2     WITH 0
   REPLACE PAGA3     WITH 0
   REPLACE PAGA4     WITH 0
   REPLACE PAGA5     WITH 0
   REPLACE PAGA6     WITH 0
   REPLACE PAGA7     WITH 0
   REPLACE PAGA8     WITH 0
   REPLACE PAGA9     WITH 0
   REPLACE PAGA10    WITH 0
   REPLACE PAGA11    WITH 0
   REPLACE PAGA12    WITH 0
   SKIP
ENDDO
GO TOP
DO WHILE .NOT. EOF()
   STORE SPACE(18) TO WCUENTA0
   DO ARMACOD0
   STORE "REPROCESANDO CUENTA: "+wcuenta0+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE LEN(RTRIM(WCUENTA0)) TO WLARCOD
   IF WLARCOD = 18
      STORE .F.      TO WFLAGMES
      STORE WCUENTA0 TO WNOCTA
      ***
      STORE "INVE"   TO WCAMPO
      STORE INVE     TO WMONTOPROC
      DO ACTUALNOM
      ***
      STORE "CORR"   TO WCAMPO
      STORE CORR     TO WMONTOPROC
      DO ACTUALNOM
      ***
      STORE "ORIG"   TO WCAMPO
      STORE ORIG     TO WMONTOPROC
      DO ACTUALNOM
   ENDIF
   SKIP
ENDDO
***** TRASPASOS
select 2
USE PRTRAS INDEX PRTRAS1
do filloc
GO TOP
DO WHILE .NOT. EOF()
   STORE "REPROCESANDO REFORMULACION: "+ORIGEN+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE ORIGEN      TO WCUENTA
   STORE MONTO       TO WMONTO

   STORE WCUENTA     TO WNOCTA
   STORE .T.         TO WFLAGMES
   STORE FECHA       TO WFECHA
   STORE "TRAS"      TO WCAMPO
   STORE WMONTO*-1   TO WMONTOPROC
   SELECT PRCTAS
   FIND &WCUENTA
   IF EOF()
      STORE "NO ENCONTRE TRASPASO ORIGEN:"+WCUENTA+" Bs."+STR(WMONTO,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ENDIF
   DO ACTUALIZA
   SELECT PRTRAS
   STORE DESTINO     TO WCUENTA
   STORE MONTO       TO WMONTO

   STORE WCUENTA     TO WNOCTA
   STORE "TRAS"      TO WCAMPO
   STORE WMONTO      TO WMONTOPROC
   SELECT PRCTAS
   FIND &WCUENTA
   IF EOF()
      STORE "NO ENCONTRE TRASPASO DESTINO:"+WCUENTA+" Bs."+STR(WMONTO,15,2) TO MES
      DO AVISO WITH MES
      RETURN
   endif
   DO ACTUALIZA
   SELECT PRTRAS
   SKIP
ENDDO
***** INCREMENTOS
SELECT 3
USE PRINCRE INDEX PRINCRE
GO TOP
DO WHILE .NOT. EOF()
   STORE SPACE(30) TO WCTAINCRE
   DO ARMAINC
   STORE "REPROCESANDO INCREMENTO: "+WCTAINCRE+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE WCTAINCRE   TO WNOCTA
   STORE .T.         TO WFLAGMES
   STORE FECHA       TO WFECHA
   STORE "INCR"      TO WCAMPO
   STORE MONTO       TO WMONTOPROC
   SELECT PRCTAS
   FIND &WCTAINCRE
   IF EOF()
      STORE "NO ENCONTRE INCREMENTO CTA.:"+WCTAINCRE+" Bs."+STR(WMONTOPROC,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ELSE   
      DO ACTUALIZA
   ENDIF
   SELECT PRINCRE
   SKIP
ENDDO
***** DISMINUCIONES
SELECT 4
USE PRDISMI INDEX PRDISMI
GO TOP
DO WHILE .NOT. EOF()
   STORE SPACE(18) TO WCTADISMI
   DO ARMADIS
   STORE "REPROCESANDO DISMINUCION: "+WCTADISMI+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE WCTADISMI   TO WNOCTA
   STORE .T.         TO WFLAGMES
   STORE FECHA       TO WFECHA
   STORE "DISM"      TO WCAMPO
   STORE MONTO       TO WMONTOPROC
   SELECT PRCTAS
   FIND &WCTADISMI
   IF EOF()
      STORE "NO ENCONTRE DISMINUCION CTA.:"+WCTADISMI+" Bs."+STR(WMONTOPROC,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ELSE   
      DO ACTUALIZA
   ENDIF
   SELECT PRDISMI
   SKIP
ENDDO
***** COMPROMISOS
SELECT 5
use prcomp index prcomp1,prcomp2,prcomp3
GO TOP
DO WHILE .NOT. EOF()
   STORE CODIGOPRE TO WCUENTA
   STORE MONTO     TO WMONTO
   STORE "REPROCESANDO COMPROMISO: "+WCUENTA+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   STORE WCUENTA  TO WNOCTA
   STORE .T.      TO WFLAGMES
   STORE FECHA    TO WFECHA
   STORE "COMP"   TO WCAMPO
   STORE WMONTO   TO WMONTOPROC
   SELECT PRCTAS
   FIND &WCUENTA
   IF EOF()
      STORE "NO ENCONTRE COMPROMISO CTA.:"+WCUENTA+" Bs."+STR(WMONTO,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ELSE   
      DO ACTUALIZA
   ENDIF
   SELECT PRCOMP
   SKIP
ENDDO

***** CAUSADOS
SELECT 6
USE PRPAGA INDEX PRPAGA1,PRPAGA2,PRPAGA3
GO TOP
DO WHILE .NOT. EOF()
   STORE CODIGOPRE TO WCUENTA
   STORE MONTOCAUS TO WMONTO
   STORE FECHACAUS TO WFECHACAUS
   STORE "REPROCESANDO CAUSADO: "+WCUENTA+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   SELECT PRCTAS
   FIND &WCUENTA
   IF EOF()
      STORE "NO ENCONTRE CAUSADOS DE CUENTA:"+WCUENTA+" Bs."+STR(WMONTO,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ELSE   
      *** CARGA NIVEL DE CAUSADO
      STORE WCUENTA    TO WNOCTA
      STORE .F.        TO WFLAGMES
      STORE WFECHACAUS TO WFECHA
      STORE "CAUS"     TO WCAMPO
      STORE WMONTO     TO WMONTOPROC
      DO ACTUALIZA
   ENDIF
   SELECT PRPAGA
   SKIP
ENDDO
***** PAGADOS
SELECT PRPAGA
GO TOP
DO WHILE .NOT. EOF()
   STORE CODIGOPRE TO WCUENTA
   STORE MONTOPAGA TO WMONTO
   STORE FECHAPAGA TO WFECHAPAGA
   STORE "REPROCESANDO PAGO: "+WCUENTA+", FAVOR ESPERAR..." TO MES
   DO MENSAJE WITH MES
   SELECT PRCTAS
   FIND &WCUENTA
   IF EOF()
      STORE "NO ENCONTRE PAGOS CTA.:"+WCUENTA+" Bs."+STR(WMONTOC,15,2) TO MES
      DO AVISO WITH MES
      UNLOCK ALL
      RETURN
   ELSE   
      STORE WCUENTA    TO WNOCTA
      STORE .T.        TO WFLAGMES
      STORE WFECHAPAGA TO WFECHA
      STORE "PAGA"     TO WCAMPO
      STORE WMONTO     TO WMONTOPROC
      DO ACTUALIZA
   ENDIF
   SELECT PRPAGA
   SKIP
ENDDO
STORE "OPERACION EFECTUADA SATISFACTORIAMENTE, <ENTER>" TO MES
DO AVISO WITH MES
CLOSE DATA
CLOSE INDEX
RETURN
